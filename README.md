# 智能信息收集系统

一个基于 Claude Code 的**独立 Plugin 项目**，能够从多个可靠信息源自动收集信息，进行深度分析，并生成结构化报告。

## 核心特性

- ✅ **独立 Plugin**：完全自包含，不依赖系统内置 Agent
- ✅ **专用 Agent**：项目内定义的 `source-processor`、`webpage-analyzer` 和 `site-evaluator`
- ✅ **多层协作**：Skill → 信息源 Agent → 网页分析 Agent
- ✅ **双通道搜索**：SITE.md 可靠源 + WebSearch 全网搜索，覆盖更广
- ✅ **并行处理**：多个信息源和网页同时处理，提高效率
- ✅ **智能筛选**：根据用户需求自动筛选和分类信息
- ✅ **深度分析**：每条信息都经过详细分析和总结
- ✅ **结构化报告**：按领域分类，段落形式叙述，带完整引用
- ✅ **自动发现新源**：智能评估并添加新发现的有价值网站到 SITE.md
- ✅ **加权评分系统**：根据发现途径自动调整信息源评分权重

## 项目结构

```
InfoCollection/
├── .claude/
│   ├── agents/
│   │   ├── source-processor.md      # 信息源处理 Agent
│   │   ├── webpage-analyzer.md      # 网页分析 Agent
│   │   └── site-evaluator.md        # 信息源评估 Agent
│   └── skills/
│       └── info-collector/
│           └── skill.md              # 主 Skill 定义
├── PERSONEL.md                       # 用户个人偏好配置
├── SITE.md                           # 可靠信息源配置（自动更新）
├── README.md                         # 本文件
└── YYYY-MM-DD/                       # 每日信息收集目录（自动创建）
    ├── {网页标题1}.md
    ├── {网页标题2}.md
    ├── {信息源名称1}-总结.md
    ├── {信息源名称2}-总结.md
    ├── 新增信息源评估.md            # 新增网站评估报告
    └── 最终报告.md
```

## 架构设计

### 四层 Agent 架构

```
info-collector Skill
    ├── source-processor Agent 1
    │   ├── webpage-analyzer Agent 1.1
    │   ├── webpage-analyzer Agent 1.2
    │   └── ...
    ├── source-processor Agent 2
    │   ├── webpage-analyzer Agent 2.1
    │   └── ...
    ├── ...
    └── site-evaluator Agent
```

**职责分工：**
- **info-collector Skill**：流程编排、配置读取、最终汇总
- **source-processor Agent**：处理单个信息源的搜索和筛选、收集新发现的网站
- **webpage-analyzer Agent**：深度分析单个网页内容
- **site-evaluator Agent**：评估新发现的网站、更新 SITE.md

### 工作流程

```
用户需求
    ↓
需求分析 → 读取配置 (PERSONEL.md, SITE.md)
    ↓
创建工作目录 (YYYY-MM-DD)
    ↓
    ├─→ 通道A: 从 SITE.md 筛选信息源
    │   └─→ 形成 SITE 类型信息源集
    │
    ├─→ 通道B: 执行 WebSearch 全网搜索
    │   ├─→ 构造 2-3 个搜索查询
    │   ├─→ 并行执行 WebSearch
    │   ├─→ 按域名分组结果
    │   └─→ 形成 WEBSEARCH 类型虚拟信息源集
    │
    ↓
合并两个通道的信息源（去重，SITE 优先）
    ↓
并行启动 source-processor Agents（区分 SITE/WEBSEARCH 类型）
    ├─→ SITE 类型: 使用 site:domain.com 搜索
    └─→ WEBSEARCH 类型: 直接使用预收集的 URL
    ↓
每个 Agent 并行启动 webpage-analyzer Agents
    ↓
收集并保存所有分析结果 + 新发现的网站（带发现途径标记）
    ↓
启动 site-evaluator Agent ← 评估新网站
    ├─→ 应用加权评分系统（根据发现途径）
    ├─→ 得分 ≥ 7.5: 自动添加
    ├─→ 得分 6.0-7.4: 添加并标注"待审核"
    └─→ 得分 < 6.0: 不添加
    ↓
更新 SITE.md（自动添加有价值的网站）
    ↓
生成最终报告 + 新增信息源评估报告
```

## 快速开始

### 1. 作为独立 Plugin 使用

将此项目作为 Plugin 添加到其他 Claude Code 项目中：

```bash
# 在你的项目中
git clone <repository-url> .plugins/InfoCollection
```

### 2. 配置

#### 编辑 PERSONEL.md

设置您的个人偏好：
- 语言偏好（中文/英文）
- 关注领域（科技、政治、经济等）
- 信息类型偏好（新闻、博客、学术）
- 默认时间范围（24小时）

#### 编辑 SITE.md

添加可靠的信息源：
```markdown
## 科技与技术

### 人工智能
- **OpenAI Blog**
  - URL: https://openai.com/blog
  - 类型: AI、GPT、研究
  - 语言: 英文
```

### 3. 使用

在 Claude Code 中启动 Skill：

```bash
/info-collector
```

或者直接告诉 Claude：

```
帮我收集今天关于人工智能的最新信息
```

## 配置说明

### PERSONEL.md 配置项

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 主要语言 | 报告生成使用的主要语言 | 中文 |
| 次要语言 | 信息源可包含的其他语言 | 英文 |
| 默认关注领域 | 不指定时收集的信息领域 | 国际与国内要事新闻 |
| 信息类型偏好 | 偏好的信息形式 | 新闻、博客、学术等 |
| 内容风格偏好 | 偏好的内容深度 | 深度 > 广度 |
| 时间范围 | 默认收集时间窗口 | 过去 24 小时 |
| **启用 WebSearch** | 是否启用全网搜索 | 是 |
| **WebSearch 权重** | 相对于 SITE.md 的权重 | 30% |
| **自动添加阈值** | 新信息源自动添加的最低分数 | 7.5 分 |
| **人工审核阈值** | 需要人工审核的分数范围 | 6.0-7.4 分 |

### SITE.md 配置格式

每个信息源需要包含：
- **名称**：信息源的显示名称（粗体）
- **URL**：信息源的访问地址
- **类型**：提供的信息类型标签
- **语言**：内容使用的语言

按以下结构组织：
- 二级标题（##）：大类（如"科技与技术"）
- 三级标题（###）：子类（如"人工智能"）
- 无序列表：具体信息源及元数据

## 使用场景

### 场景 1：每日科技新闻汇总

```
收集今天的科技新闻
```

系统会：
1. 从 SITE.md 筛选科技类信息源
2. 收集过去 24 小时的相关新闻
3. 生成按领域分类的汇总报告

### 场景 2：特定领域深度研究

```
帮我收集过去一周关于大语言模型的最新研究和应用进展
```

系统会：
1. 扩展时间范围到 7 天
2. 聚焦 AI/大语言模型相关信息源
3. 包含学术论文、技术博客、新闻报道
4. 生成综合性深度报告

### 场景 3：多领域信息追踪

```
收集今天的 AI 新闻、网络安全事件和国际要闻
```

系统会：
1. 同时处理多个领域
2. 按领域分类组织报告
3. 提供跨领域的关联分析

## 技术细节

### 指令设计原则

本项目所有 Skill 和 Agent 定义都遵循以下原则：

1. **明确的执行指令**：所有操作都使用"执行操作"、"使用 XXX 工具"等明确的动作指令
2. **详细的参数说明**：每个工具调用都详细说明所有参数的来源和格式
3. **清晰的流程控制**：使用"对每个"、"等待"、"然后"等明确的流程控制语句
4. **避免模糊示例**：不使用容易混淆的"示例"表述，而是直接给出执行指令

### Agent 定义

#### source-processor Agent

位于 `.claude/agents/source-processor.md`，负责：
- **支持双类型信息源**：
  - SITE 类型：使用 WebSearch 或 WebFetch 访问信息源并搜索相关信息
  - WEBSEARCH 类型：直接使用预收集的 URL 列表
- 筛选符合用户需求的信息条目
- 使用 Task 工具并行启动多个 webpage-analyzer Agent 分析每个网页
- 使用 Read 工具读取分析结果，使用 Write 工具汇总生成 `{信息源名称}-总结.md`
- 收集新发现的网站信息（域名、URL、出现次数、主题、**发现途径标记**）

#### webpage-analyzer Agent

位于 `.claude/agents/webpage-analyzer.md`，负责：
- 使用 WebFetch 工具读取单个网页内容
- 提取核心观点和关键信息
- 评估来源可信度
- 使用 Write 工具保存为 `{网页标题}.md`

#### site-evaluator Agent

位于 `.claude/agents/site-evaluator.md`，负责：
- 使用 Read 工具读取 SITE.md，提取已存在的网站列表
- **使用加权评分系统**评估新发现的网站：
  - 基础评分：权威性、更新频率、内容深度、出现频率、可访问性（0-10分）
  - 发现途径权重：
    - SITE引用：1.2×
    - WebSearch直接发现：1.0×
    - 混合途径：1.3×
  - 最终得分 = 基础得分 × 权重系数（0-13分）
- 使用 WebFetch 工具验证网站可访问性
- 自动决策：
  - 得分 ≥ 7.5：自动添加
  - 得分 6.0-7.4：添加并标注"待人工审核"
  - 得分 < 6.0：不添加
- 使用 Edit 工具将符合标准的网站添加到 SITE.md 的正确分类下
- 使用 Write 工具生成评估报告 `新增信息源评估.md`

### 文件命名规范

- **日期目录**：`YYYY-MM-DD`（如 `2025-10-27`）
- **网页分析**：`{网页标题}.md`
- **信息源总结**：`{信息源名称}-总结.md`
- **新增信息源评估**：`新增信息源评估.md`
- **最终报告**：`最终报告.md`

### 最终报告格式

```markdown
# 信息收集报告

**收集时间范围**: 过去 24 小时
**收集领域**: 科技、国际要闻
**报告生成时间**: 2025-10-27 14:30
**信息源数量**: 5
**信息条目数量**: 23

---

## 一、科技与技术

### 人工智能

根据最新报道[1][2]，OpenAI 发布了新版本的 GPT 模型，在多项基准测试中
表现出色。与此同时，Anthropic 也宣布[3]推出了 Claude 的重大更新...

（使用段落形式叙述，不用列表）

### 网络安全

...

## 二、国际要闻

...

---

## 信息源列表

1. OpenAI Blog - https://openai.com/blog
2. TechCrunch - https://techcrunch.com/
3. Anthropic News - https://www.anthropic.com/news
...
```

**关键特点：**
- ❌ 不使用列表形式展示信息（除非用户要求）
- ✅ 使用段落形式进行叙述性分析
- ✅ 每条信息都有引用标记 [1][2]
- ✅ 末尾有完整的信息源列表

## 性能优化

1. **并行处理**
   - 多个 source-processor Agent 并行启动
   - 每个 Agent 内部并行启动多个 webpage-analyzer Agent

2. **错误处理**
   - 单个信息源失败不影响整体流程
   - 单个网页失败不影响该信息源其他网页

3. **避免重复**
   - 文件系统缓存机制
   - 合并重复信息

## 限制与注意事项

1. **访问限制**：某些网站可能有反爬虫机制
2. **时间消耗**：
   - 双通道搜索会增加处理时间
   - WEBSEARCH 类型信息源较多时可能较慢
3. **API 限制**：
   - WebSearch 调用次数限制（建议最多 3 次查询）
   - 网页抓取受 API 调用限制
4. **内容准确性**：自动总结可能存在偏差，建议人工审核
5. **新信息源质量**：
   - WebSearch 发现的网站质量参差不齐
   - 加权评分系统已考虑发现途径，但仍建议定期审核
   - 得分 6.0-7.4 的网站会自动标注"待审核"

## 故障排除

### Skill 未启动

确保文件路径正确：
```
.claude/skills/info-collector/skill.md
```

### Agent 未找到

确保 Agent 文件存在：
```
.claude/agents/source-processor.md
.claude/agents/webpage-analyzer.md
.claude/agents/site-evaluator.md
```

### 配置文件缺失

确保以下文件在项目根目录：
- `PERSONEL.md`
- `SITE.md`

### 信息收集失败

检查：
- 网络连接是否正常
- 信息源 URL 是否可访问
- 是否触发了访问限制

## 贡献指南

欢迎提交 Issue 和 Pull Request 改进本项目。

### 开发建议

1. 添加新的信息源类型
2. 优化网页内容提取逻辑
3. 改进最终报告的格式
4. 增加更多语言支持
5. ✅ **已实现**：双通道搜索（SITE.md + WebSearch）
6. ✅ **已实现**：加权评分系统（根据发现途径）
7. 添加信息源质量监控，自动清理低质量或失效的网站
8. 优化 WebSearch 查询构造策略，提高相关性
9. 添加用户反馈机制，手动调整信息源评分

## 许可证

[MIT License](LICENSE)

---

**版本**：1.1.1
**最后更新**：2025-10-27
**作为独立 Plugin 使用**：完全自包含，可移植

**主要功能**：
- ✅ 首次启动交互式初始化（自动生成 PERSONEL.md）
- ✅ 自动发现并添加新信息源到 SITE.md
- ✅ 双通道搜索（SITE.md + WebSearch 全网搜索）
- ✅ 加权评分系统（根据发现途径自动调整权重）
- ✅ 智能去重（域名级别，SITE 优先）
- ✅ 最终报告保存到项目根目录（便于查看）

**版本历史**：
- v1.1.1 (2025-10-27): 新增首次启动交互式初始化和最终报告项目根目录输出
- v1.1.0 (2025-10-27): 新增双通道搜索和加权评分系统
- v1.0.0 (2025-10-27): 初始版本，支持单通道 SITE.md 搜索
